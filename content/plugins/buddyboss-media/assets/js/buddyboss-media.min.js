function bbmedia_getQueryVariable(e,t){if("undefined"==typeof e||""==e||"undefined"==typeof t||""==t)return"";for(var i=e.split("&"),o=0;o<i.length;o++){var a=i[o].split("=");if(a[0]==t)return a[1]}return!1}function buddyboss_media_initiate_media_move(e){if($link=$(e),$form=$("#frm_buddyboss-media-move-media"),$form_wrapper=$form.parent(),$link.closest(".activity").find("form.ac-form").slideUp(),$form_wrapper.is(":visible"))return buddyboss_media_move_media_close(),!1;$link.closest(".activity-content").after($form_wrapper);var t=$link.data("album_id");return t||(t=""),$form.find("#buddyboss_media_move_media_albums").val(t),$form_wrapper.slideDown(200),bbmedia_move_media_opened=!0,$form.find('input[name="activity_id"]').val($link.data("activity_id")),!1}function buddyboss_media_submit_media_move(){if($form=$("#frm_buddyboss-media-move-media"),$submit_button=$form.find('input[type="submit"]'),$submit_button.hasClass("loading"))return!1;var e={action:$form.find('input[name="action"]').val(),bboss_media_move_media_nonce:$form.find('input[name="bboss_media_move_media_nonce"]').val(),activity_id:$form.find('input[name="activity_id"]').val(),buddyboss_media_move_media_albums:$form.find('select[name="buddyboss_media_move_media_albums"]').val()};return $submit_button.addClass("loading"),$form.find("#message").removeAttr("class").html(""),$.ajax({type:"POST",url:ajaxurl,data:e,success:function(e){e=$.parseJSON(e),e.status?($form.find("#message").addClass("updated").html("<p>"+e.message+"</p>"),"yes"==$form.find('input[name="is_single_album"]').val()?setTimeout(function(){buddyboss_media_media_move_cleanup($form,!0)},2e3):setTimeout(function(){buddyboss_media_media_move_cleanup($form,!1)},2e3)):$form.find("#message").addClass("error").html("<p>"+e.message+"</p>"),$submit_button.removeClass("loading")}}),!1}function buddyboss_media_media_move_cleanup(e,t){e.find("#message").removeAttr("class").html(""),$form_wrapper=e.parent(),buddyboss_media_move_media_close(),t&&($activity=e.closest(".activity"),$("body").append($form_wrapper),$form_wrapper.hide(),$activity.slideUp(200,function(){$activity.remove()}))}function buddyboss_media_move_media_close(){return $form=$("#frm_buddyboss-media-move-media"),$form_wrapper=$form.parent(),$form_wrapper.slideUp(200),bbmedia_move_media_opened=!1,!1}function buddyboss_media_initiate_tagging(e){if($link=$(e),$form=$("#frm_buddyboss-media-tag-friends"),$form_wrapper=$form.parent(),$link.closest(".activity").find("form.ac-form").slideUp(),$form_wrapper.is(":visible"))return buddyboss_media_tag_friends_close(),!1;$link.closest(".activity-content").after($form_wrapper),$form_wrapper.slideDown(200),bbmedia_tag_friends_opened=!0,$form.find('input[name="activity_id"]').val($link.data("activity_id"));var t=($form.find('input[name="preloader"]').val(),{action:$form.find('input[name="action"]').val(),buddyboss_media_tag_friends_nonce:$form.find('input[name="buddyboss_media_tag_friends_nonce"]').val(),activity_id:$form.find('input[name="activity_id"]').val()});return $.ajax({type:"POST",url:ajaxurl,data:t,success:function(e){e=$.parseJSON(e),$form.find("#invite-list").html(e.friends_list),$form.find(".main-column-content").html(e.tagged_friends),$('#invite-list input[name="friends[]"]').change(function(){buddyboss_media_tag_friends_toggle_tag(t.activity_id,$(this).val())}),$("#friend-list .action .remove").click(function(e){e.preventDefault(),buddyboss_media_tag_friends_toggle_tag(t.activity_id,$(this).data("userid"))})}}),!1}function buddyboss_media_tag_friends_close(){return $form=$("#frm_buddyboss-media-tag-friends"),$form_wrapper=$form.parent(),$form_wrapper.slideUp(200),bbmedia_tag_friends_opened=!1,!1}function buddyboss_media_tag_friends_toggle_tag(e,t){$form=$("#frm_buddyboss-media-tag-friends");var i={action:$form.find('input[name="action_tag"]').val(),buddyboss_media_tag_friends_nonce:$form.find('input[name="buddyboss_media_tag_friends_nonce"]').val(),activity_id:e,friend_id:t};$.ajax({type:"POST",url:ajaxurl,data:i,success:function(e){e=$.parseJSON(e),$form.find("#invite-list").html(e.friends_list),$form.find(".main-column-content").html(e.tagged_friends),$('#invite-list input[name="friends[]"]').change(function(){buddyboss_media_tag_friends_toggle_tag(i.activity_id,$(this).val())}),$("#friend-list .action .remove").click(function(e){e.preventDefault(),buddyboss_media_tag_friends_toggle_tag(i.activity_id,$(this).data("userid"))})}})}function buddyboss_media_tag_friends_complete(){$form=$("#frm_buddyboss-media-tag-friends");var e={action:$form.find('input[name="action_tag_complete"]').val(),buddyboss_media_tag_friends_nonce:$form.find('input[name="buddyboss_media_tag_friends_nonce"]').val(),activity_id:$form.find('input[name="activity_id"]').val(),update_action:!1};return $form.closest(".activity").find(BuddyBoss_Media_Appstate.activity_header_selector).length>0&&(e.update_action=!0),$form.find('input[type="submit"]').addClass("loading"),$.ajax({type:"POST",url:ajaxurl,data:e,success:function(t){$form.find('input[type="submit"]').removeClass("loading"),e.update_action===!0&&(t=$.parseJSON(t),$activity=$form.closest(".activity"),$activity.find(BuddyBoss_Media_Appstate.activity_header_selector).html(t.activity_action),t.activity_tooltip&&($activity.find(".buddyboss-media-tt-content").remove(),$activity.append(t.activity_tooltip),window.BBMediaTooltips.initTooltips())),buddyboss_media_tag_friends_close()}}),!1}var jq=$=jQuery.noConflict();window.Code=window.Code||{Util:!1,PhotoSwipe:!1},window.BuddyBoss_Media_Util=function(e,t,i){function o(){!d.state.isMobile&&n.width()<=800?d.state.isMobile=!0:d.state.isMobile||(d.state.isMobile=!1)}var a,n=t(e),d={state:i,lang:function(e){var e=e||"undefined key!";return i[e]||"Language key missing for: "+e}};return o(),n.on("resize orientationchange",function(){clearTimeout(a),a=setTimeout(o,75)}),d}(window,window.jQuery,window.BuddyBoss_Media_Appstate||{}),window.Code.BuddyBossSwiper=function(e,t,i){function o(t,i,o){var a=bbmedia_getQueryVariable(o.data,"action"),n=function(e){return function(){"heartbeat"!==e&&BuddyBossSwiperClass.reset()}}(a);e.setTimeout(n,205),e.setTimeout(n,750)}if(!t||!i)return!1;var a,n,d,s,r=$("#buddyboss-media-grid"),l=($(document),!1),u={preventSlideshow:!0,imageScaleMethod:"fitNoUpscale",loop:!1,captionAndToolbarAutoHideDelay:0,getToolbar:function(){return'<div class="ps-toolbar-close"><div class="ps-toolbar-content"></div></div><div class="ps-toolbar-comments"><div class="ps-toolbar-content"></div></div><div class="ps-toolbar-delete"><div class="ps-toolbar-content loading" style="display:none"><i class="fa fa-spinner fa-spin"></i></div><div class="ps-toolbar-content real"></div></div><div class="ps-toolbar-previous ps-toolbar-previous-disabled"><div class="ps-toolbar-content"></div></div><div class="ps-toolbar-next"><div class="ps-toolbar-content"></div></div>'},getImageCaption:function(e){var t,i,o=$(e);return a="#",n="",0==o.find("img").length?"":(a=o.find("img")[0].getAttribute("data-permalink"),current_photo_owner=o.find("img")[0].getAttribute("data-owner"),current_photo_media=o.find("img")[0].getAttribute("data-media"),current_photo_link_elm=o,$("#bbmedia-grid-wrapper").length>0?(i=o.closest(".bbmedia-grid-item").find(".buddyboss_media_caption"),t=i.find(".buddyboss_media_caption_body"),t.find("a").remove(),n=t.text(),""===n.replace(/\s/g,"")&&(n=i.find(".buddyboss_media_caption_action").text())):(t=o.parents(".activity-inner").clone(),t.find("a").remove(),n=t.text(),""===n.replace(/\s/g,"")&&(n=o.parents(".activity-content").find(".activity-header").text())),$.trim(n))},getImageMetaData:function(){return{href:a,caption:n,owner:current_photo_owner,media:current_photo_media,link_elm:current_photo_link_elm}}};return BuddyBossSwiperClass={has_grid:function(){return r.length>0},has_photoswipe:function(){return l!==!1},location_from_current:function(){var t,i,o;return BuddyBossSwiperClass.has_photoswipe()?(t=l.getCurrentImage(),i=t.metaData.href,o={comments_href:i,current:t},$(document).trigger("buddyboss:media:comment_link",o),void setTimeout(function(){e.location=i},15)):!1},reset:function(){if(l!==!1)try{i.detatch(l)}catch(e){}BuddyBossSwiperClass.start()},start:function(){var o=BuddyBossSwiperClass.has_grid()?".gallery-icon > a":".buddyboss-media-photo-wrap",r=$(o);r.length>0&&(l=r.photoSwipe(u),l.addEventHandler(i.EventTypes.onBeforeShow,function(){$("html").css({overflow:"hidden"})}),l.addEventHandler(i.EventTypes.onHide,function(){$("html").css({overflow:"auto"}),n=null,a=null,d.off("click"),d=null,s=null,setTimeout(function(){$(e).trigger("reset_carousel")},555)}),l.addEventHandler(i.EventTypes.onCaptionAndToolbarShow,function(){d=$(".ps-caption").on("click",function(){e.location=l.getCurrentImage().metaData.href}),s=$(".ps-toolbar-comments")}),l.addEventHandler(i.EventTypes.onToolbarTap,function(o){if(o.toolbarAction===i.Toolbar.ToolbarAction.none){if(o.tapTarget===s[0]||t.DOM.isChildOf(o.tapTarget,s[0])){var a=l.getCurrentImage(),n=a.metaData.href,d={comments_href:n,current:a};$(document).trigger("buddyboss:media:comment_link",d),e.location=n}if((o.tapTarget===$(".ps-toolbar-delete")[0]||t.DOM.isChildOf(o.tapTarget,$(".ps-toolbar-delete")[0]))&&confirm(BuddyBoss_Media_Appstate.sure_delete_photo)){$(".ps-toolbar-delete").find(".loading").show(),$(".ps-toolbar-delete").find(".real").hide(),cache_ele=l.getCurrentImage().metaData.link_elm,delete_it=jq.post(ajaxurl,{action:"buddyboss_delete_media",media:l.getCurrentImage().metaData.media});try{delete_it.done(function(e){"done"==e?(jq("#activity-"+l.getCurrentImage().metaData.media).remove(),jq(".ps-toolbar-content").click()):alert(e)}),delete_it.always(function(){$(".ps-toolbar-delete").find(".loading").hide(),$(".ps-toolbar-delete").find(".real").show(),jq(cache_ele).first().click()})}catch(o){}}}}),l.addEventHandler(i.EventTypes.onDisplayImage,function(){$delete_link=$(".ps-toolbar-delete"),"1"==l.getCurrentImage().metaData.owner?$delete_link.show():$delete_link.hide()}))}},BuddyBossSwiperClass.start(),$(document).ajaxSuccess(o),BuddyBossSwiperClass}(window,window.Code.Util||!1,window.Code.PhotoSwipe||!1,window.BuddyBoss_Media_Util),window.BuddyBoss_Media_Uploader=function(e,t,i){var o=!1,a={},n=0,d=i.state||{},s=i.lang,r=[],l={init:function(){var e=this;return this.inject_markup(),this.get_elements()?(this.setup_modal(),this.setup_textbox(),setTimeout(function(){e.start_uploader()},10),void t.ajaxPrefilter(l.prefilter)):!1},destroy:function(){},inject_markup:function(){var e=t(".my-gallery .activity-greeting"),i=s("user_add_photo");e.length&&i&&e.text(i).show();var o=t("#whats-new-content"),a=t("#buddyboss-media-tpl-add-photo");a.length&&o.length&&o.before(a.html());var n=t("#buddyboss-media-tpl-preview");n.length&&o.length&&o.find("textarea").after(n.html())},get_elements:function(){return a.$whats_new=t("#whats-new"),0===a.$whats_new.length?!1:(a.$add_photo=t("#buddyboss-media-bulk-uploader"),a.$open_uploder_button=t("#buddyboss-media-add-photo-button"),a.$add_photo_button=t("#logo-file-browser-button"),a.$post_button=t("#whats-new-submit").find("[type=submit],button"),a.$uploader=t("#buddyboss-media-bulk-uploader"),a.$uploaded=t("#buddyboss-media-bulk-uploader-uploaded .images"),a.$preview_pane=t("#buddyboss-media-preview-inner"),!0)},setup_textbox:function(){a.$whats_new.blur(function(){setTimeout(function(){r&&r.length>0&&(a.$post_button.removeAttr("disabled"),a.$post_button.prop("disabled",!1))},200)})},setup_modal:function(){a.$open_uploder_button.fancybox({href:"#buddyboss-media-bulk-uploader-wrapper",minWidth:500,beforeLoad:function(){t("#buddyboss-media-bulk-uploader-text").val(a.$whats_new.val())},beforeClose:function(){t("#buddyboss-media-bulk-uploader-text").length>0&&a.$whats_new.val(t("#buddyboss-media-bulk-uploader-text").val())}}),t("#aw-whats-new-submit-bbmedia").click(function(){t.fancybox.close(),a.$post_button.trigger("click")})},prefilter:function(e,i){var o=bbmedia_getQueryVariable(e.data,"action");if("undefined"!=typeof o&&"post_update"==o){var a,n="";if(r.length>0){for(var d=0;d<r.length;d++){var s=t("<a/>").attr("href",r[d].url).attr("target","_blank").attr("title",r[d].name).addClass("buddyboss-media-photo-link").html(r[d].name)[0].outerHTML;n+=s}a=t.extend({},i.data,{content:i.data.content+" "+n,pics_uploaded:r}),e.data=t.param(a),e.success=function(e){return function(i,o,a){t.isFunction(e)&&e(i,o,a),i[0]+i[1]!=="-1"&&l.post_success(i,o,a)}}(e.success)}else i.data&&"get_single_activity_content"===i.data.action&&(e.success=function(e){return function(i,o,a){t.isFunction(e)&&e(i,o,a),i[0]+i[1]!=="-1"&&l.readmore_success(i,o,a)}}(e.success))}},post_success:function(){var e=t("li.new-update").find(".buddyboss-media-photo-wrap");e.length>0&&"object"==typeof BuddyBossSwiper&&BuddyBossSwiper.hasOwnProperty("reset")&&BuddyBossSwiper.reset(),r=[],a.$preview_pane.html(""),a.$uploaded.html(""),o.splice(0,o.files.length),n=0},start_uploader:function(){var e,i=0,l=-1!==navigator.userAgent.indexOf("IEMobile");if(l&&a.$add_photo.addClass("legacy"),o=new plupload.Uploader({runtimes:d.uploader_runtimes||"html5,flash,silverlight,html4",browse_button:a.$add_photo_button[0],dragdrop:!0,container:"buddyboss-media-bulk-uploader-reception",drop_element:"buddyboss-media-bulk-uploader-reception",max_file_size:d.uploader_filesize||"10mb",multi_selection:d.uploader_multiselect||!1,url:ajaxurl,multipart:!0,multipart_params:{action:"buddyboss_media_post_photo",cookie:encodeURIComponent(document.cookie),_wpnonce_post_update:t("input#_wpnonce_post_update").val()},flash_swf_url:d.uploader_swf_url||"",silverlight_xap_url:d.uploader_xap_url||"",filters:[{title:s("file_browse_title"),extensions:d.uploader_filetypes||"jpg,jpeg,gif,png,bmp",prevent_duplicates:!0}],init:{Init:function(){"0"==a.$add_photo.find(".moxie-shim").find("input").length?(a.$add_photo.find(".moxie-shim").first().css("z-index",10),a.$add_photo.find(".moxie-shim").css("cursor","pointer")):(clone=t(a.$add_photo_button[0]).clone(),t(a.$add_photo_button[0]).after(clone).remove(),a.$add_photo_button[0]=clone,t(a.$add_photo_button[0]).on("click",function(){a.$add_photo.find(".moxie-shim").find("input").click()}))},FilesAdded:function(e,i){if(e.files.length>d.uploader_max_files||i.length>d.uploader_max_files)return o.splice(n,o.files.length),alert(s("exceed_max_files_per_batch")),!1;for(var r=0;r<i.length;r++)if(0===t('div[data-fileid="'+i[r].id+'"]').length){var l="<div data-fileid='"+i[r].id+"' class='file uploading'><img src='"+d.uploader_temp_img+"'><progress class='buddyboss-media-progress-bar' value='0' max='100'></progress></div>";a.$uploaded.append(l),a.$preview_pane.append(l),n++}t.fancybox.update(),e.start()},UploadProgress:function(o,a){a&&a.hasOwnProperty("percent")&&(e=t('div[data-fileid="'+a.id+'"]').find("progress"),i=a.percent,e.val(i))},FileUploaded:function(e,i,o){var a=t.parseJSON(o.response);$file=t('div[data-fileid="'+i.id+'"]'),$file.removeClass("uploading"),$file.data("attachment_id",a.attachment_id),$file.find(">img").attr("src",a.url),$file.find("progress").replaceWith("<a href='#' onclick='return window.BuddyBoss_Media_Uploader.removeUploaded(\""+i.id+"\");' class='delete'>+</a>"),r.push(a),t.fancybox.update()},Error:function(){alert(s("error_uploading_photo")),$progressWrap.removeClass("uploading"),$postButton.prop("disabled",!1).removeClass("loading")}}}),o.init(),t("#buddyboss-media-bulk-uploader-reception-fake").length>0){var u=document.getElementById("buddyboss-media-bulk-uploader-reception-fake");$additional_dropzone=t(u);var m=new mOxie.FileDrop({drop_zone:u});m.ondrop=function(){a.$open_uploder_button.click(),o.addFile(m.files)},m.init();var c=new mOxie.FileInput({browse_button:t("a.browse-file-button",$additional_dropzone)[0],container:u,multiple:!0});c.onchange=function(){a.$open_uploder_button.click(),o.addFile(c.files)},c.init()}},removeUploaded:function(e){var i=t('div[data-fileid="'+e+'"]');if(r.length>0){for(var a=[],d=0;d<r.length;d++)r[d].attachment_id!==i.data("attachment_id")&&a.push(r[d]);r=a}var s=!1;return t.each(o.files,function(t,i){i.hasOwnProperty("id")&&i.id==e&&(s=i)}),s&&(o.removeFile(s),n--),i.remove(),!1}},u={setup:function(){l.init()},teardown:function(){l.destroy()},removeUploaded:function(e){return l.removeUploaded(e)}};return t(document).ready(function(){l.init()}),u}(window,window.jQuery,window.BuddyBoss_Media_Util),bbmedia_move_media_opened=!1,bbmedia_tag_friends_opened=!1,$(document).ready(function(){$(document).keyup(function(e){27!=e.keyCode||bbmedia_move_media_opened!==!0&&bbmedia_tag_friends_opened!==!0||(bbmedia_move_media_opened===!0&&buddyboss_media_move_media_close(),bbmedia_tag_friends_opened===!0&&buddyboss_media_tag_friends_close())}),BBOSS_MEDIA.is_media_page?docCookies.setItem("bp-bboss-is-media-page","yes","","/"):docCookies.removeItem("bp-bboss-is-media-page","/"),$.ajaxPrefilter(function(e){var t=e.success,i=bbmedia_getQueryVariable(e.data,"action");"undefined"!=typeof i&&"activity_get_older_updates"==i&&(e.success=function(e){$("#bbmedia-grid-wrapper #activity-stream li.load-more").remove(),null!=t&&t(e)})})}),function(e,t){var i={},o={};i.init=function(){i.initTooltips()},i.initTooltips=function(){o.tooltips=t(".buddyboss-media-tt-others"),o.tooltips.length&&o.tooltips.tooltipster({contentAsHTML:!0,functionInit:i.getTooltipContent,interactive:!0,position:"top-left",theme:"tooltipster-buddyboss"})},i.getTooltipContent=function(e){var t=e.closest(".activity").find(".buddyboss-media-tt-content").detach().html();return t},jQuery(document).ready(function(){1==BuddyBoss_Media_Appstate.enable_tagging&&(i.initTooltips(),e.BBMediaTooltips=i)})}(window,window.jQuery);var docCookies=docCookies||{getItem:function(e){return e?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},setItem:function(e,t,i,o,a,n){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var d="";if(i)switch(i.constructor){case Number:d=1/0===i?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+i;break;case String:d="; expires="+i;break;case Date:d="; expires="+i.toUTCString()}return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+d+(a?"; domain="+a:"")+(o?"; path="+o:"")+(n?"; secure":""),!0},removeItem:function(e,t,i){return this.hasItem(e)?(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(i?"; domain="+i:"")+(t?"; path="+t:""),!0):!1},hasItem:function(e){return e?new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie):!1},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=e.length,i=0;t>i;i++)e[i]=decodeURIComponent(e[i]);return e}};