function bbmedia_getQueryVariable(e,t){if(typeof e=="undefined"||e==""||typeof t=="undefined"||t=="")return"";var n=e.split("&");for(var r=0;r<n.length;r++){var i=n[r].split("=");if(i[0]==t){return i[1]}}return false}function buddyboss_media_initiate_media_move(e){$link=$(e);$form=$("#frm_buddyboss-media-move-media");$form_wrapper=$form.parent();$link.closest(".activity").find("form.ac-form").slideUp();if($form_wrapper.is(":visible")){buddyboss_media_move_media_close();return false}$link.closest(".activity-content").after($form_wrapper);var t=$link.data("album_id");if(!t)t="";$form.find("#buddyboss_media_move_media_albums").val(t);$form_wrapper.slideDown(200);bbmedia_move_media_opened=true;$form.find('input[name="activity_id"]').val($link.data("activity_id"));return false}function buddyboss_media_submit_media_move(){$form=$("#frm_buddyboss-media-move-media");$submit_button=$form.find('input[type="submit"]');if($submit_button.hasClass("loading"))return false;var e={action:$form.find('input[name="action"]').val(),bboss_media_move_media_nonce:$form.find('input[name="bboss_media_move_media_nonce"]').val(),activity_id:$form.find('input[name="activity_id"]').val(),buddyboss_media_move_media_albums:$form.find('select[name="buddyboss_media_move_media_albums"]').val()};$submit_button.addClass("loading");$form.find("#message").removeAttr("class").html("");$.ajax({type:"POST",url:ajaxurl,data:e,success:function(e){e=$.parseJSON(e);if(e.status){$form.find("#message").addClass("updated").html("<p>"+e.message+"</p>");if($form.find('input[name="is_single_album"]').val()=="yes"){setTimeout(function(){buddyboss_media_media_move_cleanup($form,true)},2e3)}else{setTimeout(function(){buddyboss_media_media_move_cleanup($form,false)},2e3)}}else{$form.find("#message").addClass("error").html("<p>"+e.message+"</p>")}$submit_button.removeClass("loading")}});return false}function buddyboss_media_media_move_cleanup(e,t){e.find("#message").removeAttr("class").html("");$form_wrapper=e.parent();buddyboss_media_move_media_close();if(t){$activity=e.closest(".activity");$("body").append($form_wrapper);$form_wrapper.hide();$activity.slideUp(200,function(){$activity.remove()})}}function buddyboss_media_move_media_close(){$form=$("#frm_buddyboss-media-move-media");$form_wrapper=$form.parent();$form_wrapper.slideUp(200);bbmedia_move_media_opened=false;return false}function buddyboss_media_initiate_tagging(e){$link=$(e);$form=$("#frm_buddyboss-media-tag-friends");$form_wrapper=$form.parent();$link.closest(".activity").find("form.ac-form").slideUp();if($form_wrapper.is(":visible")){buddyboss_media_tag_friends_close();return false}$link.closest(".activity-content").after($form_wrapper);$form_wrapper.slideDown(200);bbmedia_tag_friends_opened=true;$form.find('input[name="activity_id"]').val($link.data("activity_id"));var t=$form.find('input[name="preloader"]').val();var n={action:$form.find('input[name="action"]').val(),buddyboss_media_tag_friends_nonce:$form.find('input[name="buddyboss_media_tag_friends_nonce"]').val(),activity_id:$form.find('input[name="activity_id"]').val()};$.ajax({type:"POST",url:ajaxurl,data:n,success:function(e){e=$.parseJSON(e);$form.find("#invite-list").html(e.friends_list);$form.find(".main-column-content").html(e.tagged_friends);$('#invite-list input[name="friends[]"]').change(function(){buddyboss_media_tag_friends_toggle_tag(n.activity_id,$(this).val())});$("#friend-list .action .remove").click(function(e){e.preventDefault();buddyboss_media_tag_friends_toggle_tag(n.activity_id,$(this).data("userid"))})}});return false}function buddyboss_media_tag_friends_close(){$form=$("#frm_buddyboss-media-tag-friends");$form_wrapper=$form.parent();$form_wrapper.slideUp(200);bbmedia_tag_friends_opened=false;return false}function buddyboss_media_tag_friends_toggle_tag(e,t){$form=$("#frm_buddyboss-media-tag-friends");var n={action:$form.find('input[name="action_tag"]').val(),buddyboss_media_tag_friends_nonce:$form.find('input[name="buddyboss_media_tag_friends_nonce"]').val(),activity_id:e,friend_id:t};$.ajax({type:"POST",url:ajaxurl,data:n,success:function(e){e=$.parseJSON(e);$form.find("#invite-list").html(e.friends_list);$form.find(".main-column-content").html(e.tagged_friends);$('#invite-list input[name="friends[]"]').change(function(){buddyboss_media_tag_friends_toggle_tag(n.activity_id,$(this).val())});$("#friend-list .action .remove").click(function(e){e.preventDefault();buddyboss_media_tag_friends_toggle_tag(n.activity_id,$(this).data("userid"))})}})}function buddyboss_media_tag_friends_complete(){$form=$("#frm_buddyboss-media-tag-friends");var e={action:$form.find('input[name="action_tag_complete"]').val(),buddyboss_media_tag_friends_nonce:$form.find('input[name="buddyboss_media_tag_friends_nonce"]').val(),activity_id:$form.find('input[name="activity_id"]').val(),update_action:false};if($form.closest(".activity").find(BuddyBoss_Media_Appstate.activity_header_selector).length>0){e.update_action=true}$form.find('input[type="submit"]').addClass("loading");$.ajax({type:"POST",url:ajaxurl,data:e,success:function(t){$form.find('input[type="submit"]').removeClass("loading");if(e.update_action===true){t=$.parseJSON(t);$activity=$form.closest(".activity");$activity.find(BuddyBoss_Media_Appstate.activity_header_selector).html(t.activity_action);if(t.activity_tooltip){$activity.find(".buddyboss-media-tt-content").remove();$activity.append(t.activity_tooltip);window.BBMediaTooltips.initTooltips()}}buddyboss_media_tag_friends_close()}});return false}var jq=$=jQuery;window.Code=window.Code||{Util:false,PhotoSwipe:false};window.BuddyBoss_Media_Util=function(e,t,n,r){function u(){if(!s.state.isMobile&&i.width()<=800){s.state.isMobile=true}else if(!s.state.isMobile){s.state.isMobile=false}}var i=t(e);var s={state:n,lang:function(e){var e=e||"undefined key!";return n[e]||"Language key missing for: "+e}};var o;u();i.on("resize orientationchange",function(){clearTimeout(o);o=setTimeout(u,75)});return s}(window,window.jQuery,window.BuddyBoss_Media_Appstate||{});window.Code.BuddyBossSwiper=function(e,t,n,r){function h(t,n,r){var i=bbmedia_getQueryVariable(r.data,"action");var s=function(e){return function(){if(e!=="heartbeat"){BuddyBossSwiperClass.reset()}}}(i);e.setTimeout(s,205);e.setTimeout(s,750)}if(!t||!n){return false}var i=$("#buddyboss-media-grid"),s=$(document),o=false,u,a,f,l,c={preventSlideshow:true,imageScaleMethod:"fitNoUpscale",loop:false,captionAndToolbarAutoHideDelay:0,getToolbar:function(){return'<div class="ps-toolbar-close"><div class="ps-toolbar-content"></div></div><div class="ps-toolbar-comments"><div class="ps-toolbar-content"></div></div><div class="ps-toolbar-delete"><div class="ps-toolbar-content loading" style="display:none"><i class="fa fa-spinner fa-spin"></i></div><div class="ps-toolbar-content real"></div></div><div class="ps-toolbar-previous ps-toolbar-previous-disabled"><div class="ps-toolbar-content"></div></div><div class="ps-toolbar-next"><div class="ps-toolbar-content"></div></div>'},getImageCaption:function(e){var t=$(e);var n,r;u="#";a="";if(t.find("img").length==0)return"";u=t.find("img")[0].getAttribute("data-permalink");current_photo_owner=t.find("img")[0].getAttribute("data-owner");current_photo_media=t.find("img")[0].getAttribute("data-media");current_photo_link_elm=t;if($("#bbmedia-grid-wrapper").length>0){r=t.closest(".bbmedia-grid-item").find(".buddyboss_media_caption");n=r.find(".buddyboss_media_caption_body");n.find("a").remove();a=n.text();if(a.replace(/\s/g,"")===""){a=r.find(".buddyboss_media_caption_action").text()}}else{n=t.parents(".activity-inner").clone();n.find("a").remove();a=n.text();if(a.replace(/\s/g,"")===""){a=t.parents(".activity-content").find(".activity-header").text()}}return $.trim(a)},getImageMetaData:function(e){return{href:u,caption:a,owner:current_photo_owner,media:current_photo_media,link_elm:current_photo_link_elm}}};BuddyBossSwiperClass={has_grid:function(){return i.length>0},has_photoswipe:function(){return o!==false},location_from_current:function(){var t,n,r;if(!BuddyBossSwiperClass.has_photoswipe()){return false}t=o.getCurrentImage();n=t.metaData.href;r={comments_href:n,current:t};$(document).trigger("buddyboss:media:comment_link",r);setTimeout(function(){e.location=n},15)},reset:function(){if(o!==false){try{n.detatch(o)}catch(e){}}BuddyBossSwiperClass.start()},start:function(){var r=BuddyBossSwiperClass.has_grid()?".gallery-icon > a":".buddyboss-media-photo-wrap";var i=$(r);if(i.length>0){o=i.photoSwipe(c);o.addEventHandler(n.EventTypes.onBeforeShow,function(e){$("html").css({overflow:"hidden"})});o.addEventHandler(n.EventTypes.onHide,function(t){$("html").css({overflow:"auto"});a=null;u=null;f.off("click");f=null;l=null;setTimeout(function(){$(e).trigger("reset_carousel")},555)});o.addEventHandler(n.EventTypes.onCaptionAndToolbarShow,function(t){f=$(".ps-caption").on("click",function(t){e.location=o.getCurrentImage().metaData.href});l=$(".ps-toolbar-comments")});o.addEventHandler(n.EventTypes.onToolbarTap,function(r){if(r.toolbarAction===n.Toolbar.ToolbarAction.none){if(r.tapTarget===l[0]||t.DOM.isChildOf(r.tapTarget,l[0])){var i=o.getCurrentImage(),s=i.metaData.href,u={comments_href:s,current:i};$(document).trigger("buddyboss:media:comment_link",u);e.location=s}if(r.tapTarget===$(".ps-toolbar-delete")[0]||t.DOM.isChildOf(r.tapTarget,$(".ps-toolbar-delete")[0])){if(confirm(BuddyBoss_Media_Appstate.sure_delete_photo)){$(".ps-toolbar-delete").find(".loading").show();$(".ps-toolbar-delete").find(".real").hide();cache_ele=o.getCurrentImage().metaData.link_elm;delete_it=jq.post(ajaxurl,{action:"buddyboss_delete_media",media:o.getCurrentImage().metaData.media});try{delete_it.done(function(e){if(e=="done"){jq("#activity-"+o.getCurrentImage().metaData.media).remove();jq(".ps-toolbar-content").click()}else{alert(e)}});delete_it.always(function(){$(".ps-toolbar-delete").find(".loading").hide();$(".ps-toolbar-delete").find(".real").show();jq(cache_ele).first().click()})}catch(r){}}}}});o.addEventHandler(n.EventTypes.onDisplayImage,function(e){$delete_link=$(".ps-toolbar-delete");if(o.getCurrentImage().metaData.owner=="1"){$delete_link.show()}else{$delete_link.hide()}})}}};BuddyBossSwiperClass.start();$(document).ajaxSuccess(h);return BuddyBossSwiperClass}(window,window.Code.Util||false,window.Code.PhotoSwipe||false,window.BuddyBoss_Media_Util);window.BuddyBoss_Media_Uploader=function(e,t,n,r){var i=false;var s={};var o=n.state||{},u=n.lang;var a=false;var f={init:function(){var e=this;this.inject_markup();if(!this.get_elements()){return false}this.setup_textbox();setTimeout(function(){e.start_uploader()},10);t.ajaxPrefilter(f.prefilter)},destroy:function(){},inject_markup:function(){var e=t(".my-gallery .activity-greeting"),n=u("user_add_photo");if(e.length&&!!n){e.text(n).show()}var r=t("#whats-new-content");var i=t("#buddyboss-media-tpl-add-photo");if(i.length&&r.length){r.before(i.html())}var s=t("#buddyboss-media-tpl-preview");if(s.length&&r.length){r.find("textarea").after(s.html())}},get_elements:function(){s.$whats_new=t("#whats-new");if(s.$whats_new.length===0){return false}s.$add_photo=t("#buddyboss-media-add-photo");s.$add_photo_button=t("#buddyboss-media-add-photo-button");s.$post_button=t("#whats-new-submit").find("[type=submit],button");s.$preview_pane=t("#buddyboss-media-preview");s.$preview_inner=t("#buddyboss-media-preview-inner");return true},setup_textbox:function(){s.$whats_new.blur(function(){setTimeout(function(){if(a&&a.name){s.$post_button.removeAttr("disabled");s.$post_button.prop("disabled",false)}},200)})},prefilter:function(e,n,r){var i=bbmedia_getQueryVariable(e.data,"action");if(typeof i=="undefined"||i!="post_update")return;var s,o;if(typeof a=="object"&&a.hasOwnProperty("name")){o=t("<a/>").attr("href",a.url).attr("target","_blank").attr("title",a.name).addClass("buddyboss-media-photo-link").html(a.name)[0].outerHTML;s=t.extend({},n.data,{content:n.data.content+" "+o,has_pic:a});e.data=t.param(s);e.success=function(e){return function(n,r,i){if(t.isFunction(e)){e(n,r,i)}if(n[0]+n[1]!=="-1"){f.post_success(n,r,i)}}}(e.success)}else if(n.data&&n.data.action==="get_single_activity_content"){e.success=function(e){return function(n,r,i){if(t.isFunction(e)){e(n,r,i)}if(n[0]+n[1]!=="-1"){f.readmore_success(n,r,i)}}}(e.success)}},post_success:function(n){if(s.$preview_inner&&s.$preview_inner.length){s.$preview_inner.html("")}if(s.$preview_pane&&s.$preview_inner.length){s.$preview_pane.stop().animate({height:"0px"})}if(0!==t("#is-buddyboss-media-grid").length){document.location=e.location.href}var r=t("li.new-update").find(".buddyboss-media-photo-wrap");if(r.length>0&&typeof BuddyBossSwiper=="object"&&BuddyBossSwiper.hasOwnProperty("reset")){BuddyBossSwiper.reset()}a=false},start_uploader:function(){var e=s.$preview_pane,n=s.$preview_inner;$postButton=s.$post_button,maxWidth=t("#whats-new-options").width();var r=t(".buddyboss-media-progress").first(),f=r.find("progress").first(),l=r.find(".buddyboss-media-progress-value"),c=0,h;var p=function(){if(f.val()<100){f.val(f.val()+2)}if(f.val()<100&&c!=100){h=setTimeout(p,300)}else if(c==100){f.val(100)}l.html(f.val()+"%")};$postButton.on("click",function(e){if(r.hasClass("uploading")){e.preventDefault();e.stopPropagation();alert(u("error_photo_is_uploading"));return false}});var d=navigator.userAgent.indexOf("IEMobile")!==-1;if(d){s.$add_photo.addClass("legacy")}i=new plupload.Uploader({runtimes:o.uploader_runtimes||"html5,flash,silverlight,html4",browse_button:s.$add_photo_button[0],container:s.$add_photo[0],max_file_size:o.uploader_filesize||"10mb",multi_selection:o.uploader_multiselect||false,url:ajaxurl,multipart:true,multipart_params:{action:"buddyboss_media_post_photo",cookie:encodeURIComponent(document.cookie),_wpnonce_post_update:t("input#_wpnonce_post_update").val()},flash_swf_url:o.uploader_swf_url||"",silverlight_xap_url:o.uploader_xap_url||"",filters:[{title:u("file_browse_title"),extensions:o.uploader_filetypes||"jpg,jpeg,gif,png,bmp"}],init:{Init:function(){if(s.$add_photo.find(".moxie-shim").find("input").length=="0"){s.$add_photo.find(".moxie-shim").first().css("z-index",10);s.$add_photo.find(".moxie-shim").css("cursor","pointer")}else{clone=t(s.$add_photo_button[0]).clone();t(s.$add_photo_button[0]).after(clone).remove();s.$add_photo_button[0]=clone;t(s.$add_photo_button[0]).on("click",function(){s.$add_photo.find(".moxie-shim").find("input").click()})}},FilesAdded:function(e,n){t("#buddyboss-media-preview").animate({height:"0px"});a=false;r.addClass("uploading");$postButton.prop("disabled",true).addClass("disabled");c=0;f.val(0);l.html(0+"%");h=setTimeout(p,300);e.start()},UploadProgress:function(e,t){if(t&&t.hasOwnProperty("percent")){clearTimeout(h);c=t.percent;f.val(c);l.html(c+"%")}if(t&&t.hasOwnProperty("percent")&&t.percent==100&&o.isMobile){l.html(u("resizing"))}},FileUploaded:function(i,s,f){var c=t.parseJSON(f.response);$postButton.prop("disabled",false).removeClass("disabled").addClass("uploaded");if(!c){alert(u("error_uploading_photo"))}if(c.hasOwnProperty("error")){alert(c.message);return false}if(o.isMobile){l.html(u("one_moment"))}var h=c.hasOwnProperty("url")?c.url:false;n.empty();e.animate({height:0},function(){r.removeClass("uploading");if(h){n.html('<img src="'+h+'">');var i,s,o;var u=t("#buddyboss-media-preview-inner img").load(function(){i=this.width;s=this.height;if(i>maxWidth){o=maxWidth/i;i=maxWidth;s=s*o;t(this).css("width",i);t(this).css("height",s)}t("#whats-new-options").animate({height:40});e.animate({height:s})});a=c}})},Error:function(e,t){alert(u("error_uploading_photo"));r.removeClass("uploading");$postButton.prop("disabled",false).removeClass("loading");a=false}}});i.init()}};var l={setup:function(){f.init()},teardown:function(){f.destroy()}};t(document).ready(function(){f.init()});return l}(window,window.jQuery,window.BuddyBoss_Media_Util);bbmedia_move_media_opened=false;bbmedia_tag_friends_opened=false;$(document).ready(function(){$(document).keyup(function(e){if(e.keyCode==27&&(bbmedia_move_media_opened===true||bbmedia_tag_friends_opened===true)){if(bbmedia_move_media_opened===true)buddyboss_media_move_media_close();if(bbmedia_tag_friends_opened===true)buddyboss_media_tag_friends_close()}});if(BBOSS_MEDIA.is_media_page){docCookies.setItem("bp-bboss-is-media-page","yes","","/")}else{docCookies.removeItem("bp-bboss-is-media-page","/")}$.ajaxPrefilter(function(e,t,n){var r=e.success;var i=bbmedia_getQueryVariable(e.data,"action");if(typeof i=="undefined"||i!="activity_get_older_updates")return;e.success=function(e){$("#bbmedia-grid-wrapper #activity-stream li.load-more").remove();if(r!=null){r(e)}}})});(function(e,t){var n={};var r={};n.init=function(){n.initTooltips()};n.initTooltips=function(){r.tooltips=t(".buddyboss-media-tt-others");if(r.tooltips.length){r.tooltips.tooltipster({contentAsHTML:true,functionInit:n.getTooltipContent,interactive:true,position:"top-left",theme:"tooltipster-buddyboss"})}};n.getTooltipContent=function(e,t){var n=e.closest(".activity").find(".buddyboss-media-tt-content").detach().html();return n};jQuery(document).ready(function(){if(BuddyBoss_Media_Appstate.enable_tagging==true){n.initTooltips();e.BBMediaTooltips=n}})})(window,window.jQuery);var docCookies=docCookies||{getItem:function(e){if(!e){return null}return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t,n,r,i,s){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e)){return false}var o="";if(n){switch(n.constructor){case Number:o=n===Infinity?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:o="; expires="+n;break;case Date:o="; expires="+n.toUTCString();break}}document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+o+(i?"; domain="+i:"")+(r?"; path="+r:"")+(s?"; secure":"");return true},removeItem:function(e,t,n){if(!this.hasItem(e)){return false}document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(n?"; domain="+n:"")+(t?"; path="+t:"");return true},hasItem:function(e){if(!e){return false}return(new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=")).test(document.cookie)},keys:function(){var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/);for(var t=e.length,n=0;n<t;n++){e[n]=decodeURIComponent(e[n])}return e}}