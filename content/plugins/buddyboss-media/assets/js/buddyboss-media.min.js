function bbmedia_getQueryVariable(e,t){var n=e.split("&");for(var r=0;r<n.length;r++){var i=n[r].split("=");if(i[0]==t){return i[1]}}return false}var jq=$=jQuery;window.Code=window.Code||{Util:false,PhotoSwipe:false};window.BuddyBoss_Media_Util=function(e,t,n,r){function u(){if(!s.state.isMobile&&i.width()<=800){s.state.isMobile=true}else if(!s.state.isMobile){s.state.isMobile=false}}var i=t(e);var s={state:n,lang:function(e){var e=e||"undefined key!";return n[e]||"Language key missing for: "+e}};var o;u();i.on("resize orientationchange",function(){clearTimeout(o);o=setTimeout(u,75)});return s}(window,window.jQuery,window.BuddyBoss_Media_Appstate||{});window.Code.BuddyBossSwiper=function(e,t,n){function c(t,n,r){e.setTimeout(BuddyBossSwiperClass.reset,205);e.setTimeout(BuddyBossSwiperClass.reset,750)}if(!t||!n){return false}var r=$("#buddyboss-media-grid"),i=$(document),s=false,o,u,a,f,l={preventSlideshow:true,imageScaleMethod:"fitNoUpscale",loop:false,captionAndToolbarAutoHideDelay:0,getToolbar:function(){return'<div class="ps-toolbar-close"><div class="ps-toolbar-content"></div></div><div class="ps-toolbar-comments"><div class="ps-toolbar-content"></div></div><div class="ps-toolbar-previous ps-toolbar-previous-disabled"><div class="ps-toolbar-content"></div></div><div class="ps-toolbar-next"><div class="ps-toolbar-content"></div></div>'},getImageCaption:function(e){var t=$(e);o="#";u="";if(t.find("img").length==0)return"";o=t.find("img")[0].getAttribute("data-permalink");u=r.length>0?t.parents(".gallery-icon").find(".buddyboss_media_action").text():t.parents(".activity-content").find(".activity-header").text();return u},getImageMetaData:function(e){return{href:o,caption:u}}};BuddyBossSwiperClass={has_grid:function(){return r.length>0},has_photoswipe:function(){return s!==false},location_from_current:function(){var t,n,r;if(!BuddyBossSwiperClass.has_photoswipe()){return false}t=s.getCurrentImage();n=t.metaData.href;r={comments_href:n,current:t};$(document).trigger("buddyboss:media:comment_link",r);setTimeout(function(){e.location=n},15)},reset:function(){if(s!==false){n.detatch(s)}BuddyBossSwiperClass.start()},start:function(){var r=BuddyBossSwiperClass.has_grid()?".gallery-icon > a":".buddyboss-media-photo-wrap";var i=$(r);if(i.length>0){s=i.photoSwipe(l);s.addEventHandler(n.EventTypes.onBeforeShow,function(e){$("html").css({overflow:"hidden"})});s.addEventHandler(n.EventTypes.onHide,function(t){$("html").css({overflow:"auto"});u=null;o=null;a.off("click");a=null;f=null;setTimeout(function(){$(e).trigger("reset_carousel")},555)});s.addEventHandler(n.EventTypes.onCaptionAndToolbarShow,function(t){a=$(".ps-caption").on("click",function(t){e.location=s.getCurrentImage().metaData.href});f=$(".ps-toolbar-comments")});s.addEventHandler(n.EventTypes.onToolbarTap,function(r){if(r.toolbarAction===n.Toolbar.ToolbarAction.none){if(r.tapTarget===f[0]||t.DOM.isChildOf(r.tapTarget,f[0])){var i=s.getCurrentImage(),o=i.metaData.href,u={comments_href:o,current:i};$(document).trigger("buddyboss:media:comment_link",u);e.location=o}}})}}};BuddyBossSwiperClass.start();$(document).ajaxSuccess(c);return BuddyBossSwiperClass}(window,window.Code.Util||false,window.Code.PhotoSwipe||false);window.BuddyBoss_Media_Uploader=function(e,t,n,r){var i=false;var s={};var o=n.state||{},u=n.lang;var a=false;var f={init:function(){var e=this;this.inject_markup();if(!this.get_elements()){return false}this.setup_textbox();setTimeout(function(){e.start_uploader()},10);t.ajaxPrefilter(f.prefilter)},destroy:function(){},inject_markup:function(){var e=t(".my-gallery .activity-greeting"),n=u("user_add_photo");if(e.length&&!!n){e.text(n).show()}var r=t("#whats-new-content");var i=t("#buddyboss-media-tpl-add-photo");if(i.length&&r.length){r.before(i.html())}var s=t("#buddyboss-media-tpl-preview");if(s.length&&r.length){r.after(s.html())}},get_elements:function(){s.$whats_new=t("#whats-new");if(s.$whats_new.length===0){return false}s.$add_photo=t("#buddyboss-media-add-photo");s.$add_photo_button=t("#buddyboss-media-add-photo-button");s.$post_button=t("#whats-new-submit").find("[type=submit],button");s.$preview_pane=t("#buddyboss-media-preview");s.$preview_inner=t("#buddyboss-media-preview-inner");return true},setup_textbox:function(){s.$whats_new.blur(function(){setTimeout(function(){if(a&&a.name){s.$post_button.removeAttr("disabled");s.$post_button.prop("disabled",false)}},200)})},prefilter:function(e,n,r){var i=bbmedia_getQueryVariable(e.data,"action");if(typeof i=="undefined"||i!="post_update")return;var s,o;if(typeof a=="object"&&a.hasOwnProperty("name")){o=t("<a/>").attr("href",a.url).attr("target","_blank").attr("title",a.name).addClass("buddyboss-media-photo-link").html(a.name)[0].outerHTML;s=t.extend({},n.data,{content:n.data.content+" "+o,has_pic:a});e.data=t.param(s);e.success=function(e){return function(n,r,i){if(t.isFunction(e)){e(n,r,i)}if(n[0]+n[1]!=="-1"){f.post_success(n,r,i)}}}(e.success)}else if(n.data&&n.data.action==="get_single_activity_content"){e.success=function(e){return function(n,r,i){if(t.isFunction(e)){e(n,r,i)}if(n[0]+n[1]!=="-1"){f.readmore_success(n,r,i)}}}(e.success)}},post_success:function(e){if(s.$preview_inner&&s.$preview_inner.length){s.$preview_inner.html("")}if(s.$preview_pane&&s.$preview_inner.length){s.$preview_pane.stop().animate({height:"0px"})}if(0!==t("#is-buddyboss-media-grid").length){var n=t("#is-buddyboss-media-grid").data("url");if(n.length>6){document.location=n}}var r=t("li.new-update").find(".buddyboss-media-photo-wrap");if(r.length>0&&typeof BuddyBossSwiper=="object"&&BuddyBossSwiper.hasOwnProperty("reset")){BuddyBossSwiper.reset()}a=false},start_uploader:function(){var n=s.$preview_pane,r=s.$preview_inner;$postButton=s.$post_button,maxWidth=t("#whats-new-options").width();var f=t(".buddyboss-media-progress").first(),l=f.find("progress").first(),c=f.find(".buddyboss-media-progress-value"),h=0,p;var d=function(){if(l.val()<h){l.val(l.val()+1)}if(l.val()<100&&h!=100){p=setTimeout(d,1e3/60)}else if(h==100){l.val(100)}};$postButton.on("click",function(e){if(f.hasClass("uploading")){e.preventDefault();e.stopPropagation();alert(u("error_photo_is_uploading"));return false}});var v="closed";var m=navigator.userAgent.indexOf("IEMobile")!==-1;if(m){s.$add_photo.addClass("legacy")}if(o.isMobile){s.$add_photo_button.on("click",function(e){if(v==="closed"){s.$add_photo.find(".moxie-shim").find("input").trigger("click");return false}});o.uploader_runtimes="html5"}i=new plupload.Uploader({runtimes:o.uploader_runtimes||"html5,flash,silverlight,html4",browse_button:s.$add_photo_button[0],container:s.$add_photo[0],max_file_size:o.uploader_filesize||"10mb",multi_selection:o.uploader_multiselect||false,url:ajaxurl,multipart:true,multipart_params:{action:"buddyboss_media_post_photo",cookie:encodeURIComponent(document.cookie),_wpnonce_post_update:t("input#_wpnonce_post_update").val()},flash_swf_url:o.uploader_swf_url||"",silverlight_xap_url:o.uploader_xap_url||"",filters:[{title:u("file_browse_title"),extensions:o.uploader_filetypes||"jpg,jpeg,gif,png,bmp"}],init:{FilesAdded:function(e,n){t("#buddyboss-media-preview").animate({height:"0px"});a=false;f.addClass("uploading");$postButton.prop("disabled",true).addClass("disabled");h=0;l.val(0);c.html(0+"%");p=setTimeout(d,1e3/60);v="closed";e.start()},UploadProgress:function(t,n){if(n&&n.hasOwnProperty("percent")){h=n.percent;c.html(h+"%")}if(n&&n.hasOwnProperty("percent")&&n.percent==100&&e.BuddyBoss_Media&&e.BuddyBoss_Media.isMobile){c.html("")}},FileUploaded:function(i,s,o){var l=t.parseJSON(o.response);$postButton.prop("disabled",false).removeClass("disabled").addClass("uploaded");if(!l){alert(u("error_uploading_photo"))}if(l.hasOwnProperty("error")){alert(l.message);return false}if(e.BuddyBoss_Media&&e.BuddyBoss_Media.isMobile){c.html(u("one_moment"))}var h=l.hasOwnProperty("url")?l.url:false;r.empty();n.animate({height:0},function(){f.removeClass("uploading");if(h){r.html('<img src="'+h+'">');var e,i,s;var o=t("#buddyboss-media-preview-inner img").load(function(){e=this.width;i=this.height;if(e>maxWidth){s=maxWidth/e;e=maxWidth;i=i*s;t(this).css("width",e);t(this).css("height",i)}t("#whats-new-options").animate({height:40});n.animate({height:i})});a=l}})},Error:function(e,t){alert(u("error_uploading_photo"));f.removeClass("uploading");$postButton.prop("disabled",false).removeClass("loading");v="closed";a=false}}});i.init()}};var l={setup:function(){f.init()},teardown:function(){f.destroy()}};t(document).ready(function(){f.init()});return l}(window,window.jQuery,window.BuddyBoss_Media_Util)